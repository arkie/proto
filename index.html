<html><head><style type="text/css">
	canvas {float:left;}
	.inner {overflow:hidden; height:100px; width:100px;}
	.inner:hover {background:#fff; border:1px solid #000;
		font-size:large; height:222px; left:-61px; overflow:auto;
		position:relative; top:-61px; width:222px;}
	.message {border:1px solid #000; font-size:xx-small; float:left;
		height:100px; margin:10px; width:100px;}
</style>
<script src="http://cdn.socket.io/stable/socket.io.js"
	type="text/javascript"></script>
<script type="text/javascript">
	window.onload=function(){
		var live = 'message', dead = 'message dead';
		var content = document.getElementById('content');
		new io.Socket().on('message', function(data){
			var div = content.getElementsByClassName('dead')[0];
			if (!div){
				div = document.createElement('div');
				content.appendChild(div);
			}
			div.className = 'message';
			div.innerHTML = ['<div class="inner">',
				'<canvas width="40" height="40"></canvas>',
				'<a href="http://twitter.com/', data.screen, '">',
				data.name, '</a> ', data.text, '</div>'].join('');
			div.max = div.time = 50;
			div.display = div.firstChild.firstChild.getContext('2d');
			div.onclick = function(){
				this.max = this.time += 200; this.className = live;
			}
		}).connect();
		setInterval(function(){
			var messages = content.getElementsByClassName('message'), seq = true;
			for (var i = messages.length-1; i >= 0; i--){
				var e = messages[i]; if (e.firstChild)
				if (e.time >= 2){ seq = false; e.time--;
					with (e.display){
						beginPath();
						clearRect(0, 0, 40, 40); lineTo(20, 20);
						arc(20, 20, 10, 0, (2*e.time/e.max-2)*Math.PI);
						closePath(); fill();
						strokeStyle = '#fff';
						strokeText(Math.floor(e.time/10), 14, 24);
					}
				} else {
					if (e.className == live){
						e.className = dead;
						e.display.clearRect(0, 0, 40, 40);
					}
					if (seq) content.removeChild(e);
				}
			}
		}, 100);
	}
</script></head><body>
	<div id="content"></div>
</body></html>
