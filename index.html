<!DOCTYPE html>
<html>
  <head>
    <style>
      body, html {height: 100%; margin: 0; padding: 0;}
    </style>
  </head>
  <body>
    <div id="terminal" style="position:relative; width:100%; height:100%"></div>
    <script src="https://arkie.gitlab.io/libapps-mirror/hterm.js"></script>
    <script>
      hterm.defaultStorage = new lib.Storage.Local();
      var t = new hterm.Terminal();
      t.onTerminalReady = function() {
        var io = t.io.push();
        io.onVTKeystroke = function(str) {
          var data = JSON.stringify({
            data: btoa(str),
            type: "data"
          });
          ws.send(data);
        };
        io.sendString = io.onVTKeystroke;
        io.onTerminalResize = function(columns, rows) {
          var data = JSON.stringify({
            col: columns,
            row: rows,
            type: "size"
          });
          ws.send(data);
        };
      };
      var term = document.getElementById('terminal');
      t.decorate(term);
      t.installKeyboard(term);
      var ws = new WebSocket(`ws://${window.location.host}/pty`);
      ws.onmessage = function(e) {
        t.io.print(e.data);
      };
      ws.onclose = function(e) {
        console.log('close', e);
        window.location.reload();
      }
    </script>
  </body>
</html>
