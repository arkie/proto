<html><head><style type="text/css">
	canvas {height:100%; left:0; opacity:.2; position:absolute;
		top:0; width:100%; z-index:-1000;}
	.inner {height:100px; overflow:hidden; position:relative; width:100px;}
	.inner:hover {background:rgba(255, 255, 255, .8); border:1px solid #000;
		font-size:large; height:222px; left:-61px;
		overflow:auto; top:-61px; width:222px; z-index:1;}
	.message {border:1px solid #000; font-size:xx-small; float:left;
		height:100px; margin:10px; width:100px;}
	.profile {float:left;}
</style>
<script src="http://cdn.socket.io/stable/socket.io.js"
	type="text/javascript"></script>
<script type="text/javascript">
	window.onload=function(){
		var live = 'message', dead = 'message dead';
		var content = document.getElementById('content');
		new io.Socket().on('message', function(data){
			var div = content.getElementsByClassName('dead')[0];
			if (!div){
				div = document.createElement('div');
				content.appendChild(div);
			}
			div.className = 'message';
			div.innerHTML = ['<div class="inner">',
				'<canvas width="100" height="100"></canvas>',
				'<img class="profile" src="', data.image,'" />',
				'<a href="http://twitter.com/', data.screen, '">',
				data.name, '[', data.followers, ']</a> ', data.text, '</div>'
			].join('');
			div.background = data.background;
			div.max = div.time = Math.floor(Math.sqrt(data.followers/10))*10+20;
			div.display = div.firstChild.firstChild.getContext('2d');
			div.onclick = function(){
				this.max = this.time += 200; this.className = live;
			}
		}).connect();
		setInterval(function(){
			var messages = content.getElementsByClassName('message'), seq = true;
			for (var i = messages.length-1; i >= 0; i--){
				var e = messages[i]; if (e.firstChild)
				if (e.time >= 2){ seq = false; e.time--;
					with (e.display){
						beginPath();
						clearRect(0, 0, 100, 100); lineTo(50, 50);
						arc(50, 50, 100, 0, (2*e.time/e.max-2)*Math.PI, false);
						closePath();
						fillStyle = e.background; fill();
					//	lineWidth = 1; stroke();
					//	strokeStyle = '#000';
					//	strokeText(Math.floor(e.time/10), 14, 24);
					}
				} else {
					if (e.className == live){
						e.className = dead;
						e.display.clearRect(0, 0, 100, 100);
					}
					if (seq) content.removeChild(e);
				}
			}
		}, 100);
	}
</script></head><body>
	<div id="content"></div>
</body></html>
